module AoC2021.Tests.Day16

open NUnit.Framework
open AoC2021.Day16
open AoC2021.Bits

[<Test>]
let TestToDecimal () =
    let input = "D2FE28"
    Assert.AreEqual("110100101111111000101000", (Bits.fromHexString >> Bits.toBinaryString) input)

[<Test>]
let ParsePacketLiteral () =
    let input = "D2FE28"
    let expected : Packet = { Version = 6; Type = 4 }, Literal 2021
    let result, bitsConsumed, bitsRemaining = parsePacketRec ((Bits.fromHexString input), 0) 
    Assert.AreEqual(expected, result)
    Assert.AreEqual(21, bitsConsumed)
    Assert.AreEqual(3, List.length bitsRemaining)
    Assert.IsTrue(List.forall ((=) false) bitsRemaining)
    

[<Test>]
let ParsePacketOp1 () =
    let input = "38006F45291200"
    let sub1 = { Version = 6; Type = 4 }, Literal 10
    let sub2 = { Version = 2; Type = 4 }, Literal 20
    let expected : Packet = { Version = 1; Type = 6 }, Operator (LessThan, (TotalBitLength, 27, [sub1; sub2]))
    Assert.AreEqual(expected, parsePacket (Bits.fromHexString input))



[<Test>]
let ParsePacketOp2 () =
    let input = "EE00D40C823060"
    let sub1 = { Version = 2; Type = 4 }, Literal 1
    let sub2 = { Version = 4; Type = 4 }, Literal 2
    let sub3 = { Version = 1; Type = 4 }, Literal 3
    let expected : Packet = { Version = 7; Type = 3 }, Operator (Maximum, (NrOfPackets, 3, [sub1; sub2; sub3]))
    Assert.AreEqual(expected, parsePacket (Bits.fromHexString input))

[<Test>]
let Day16APractice () =
    Assert.AreEqual(16, day16a "8A004A801A8002F478")
    Assert.AreEqual(12, day16a "620080001611562C8802118E34")
    Assert.AreEqual(23, day16a "C0015000016115A2E0802F182340")
    Assert.AreEqual(31, day16a "A0016C880162017C3686B18A3D4780")

let input = "020D64AEE52E55B4C017938FBBAC2D6002A53D21F9E90C18023600B80021D0862DC1700043232C2284D3B0105007251DE33CF281802D0E7001A0958C3B6EB542D2014340010B89112E228803518E2047E0004322B4128352DFE72BFE1CC77000E226B92FF7F7F0F4899CCEB788FBA632A444019349E40A801CA941898B661ECBC40820061A78E254024C126797B31A804B27C0582B2D7D4AF02791E431531100B2458A6219D29CB6C4247F7D6DB27BCBA4065138014C05B00801CC0513280108047020106460079801000332200B60002832801C200718012801503801A800B02801723F9B90009D6600D44A87B0CC8010B89D0661F980331F20A44470076767F8EF75AA94F5E1E6E9790C9008BF801AB8002171CA2A45C100661FC508B911C8043EC00C224BB8A753A6677FDB7B8EA85932F4600BE0039138612F684AB86392889C4A201253C013100623D464834200CC1787D09E76FC78200A16603A543E6D9E695E4C74C012D004646D08CAF74391B4232BDD1E4FFEE033805B3DAB074ACF351399FCCEA5F592697E1CB802B2D1D0BCFE410C015B004E46BE17973C949C213153005A6932C0129BDF675DD2CBF3482401BE7802D37AA4DFE6F549BD4A42363A200D5F40149985FEDF2ACF35AB4BD3003004A730F74019B8803F08A0943B1007A21C2487C0002DC578BC600A497B35A8050020F24432444401415002AF07A7F7FE004DB93001A931FC33A802B37FB517A4A52254010E2374C637895BF7E5CC66F53EB0CC2F4C92080292B1E7A0DB26BE6008CE1ACC801804938F530A1227F2A6A4004349A31009F7801A900021908A18C5D100722C43C8F9312CFD4040269934949661E0096FE75092ACA4F0B6A005CD6CBE1218027258AA3F00439377F5D566E338D121C0239DD9C4942FA4E8F73DFA62656402704E523896FAE9E00B4E779DE6BF15595C56DBF0ACD391802F400FA4FEADD769FD5BAE7318FCF32AB8"


[<Test>]
let Day16A () =
    Assert.AreEqual(969, day16a input)
    
    

[<Test>]
let Day16BPractice () =
    Assert.AreEqual(3, day16b "C200B40A82")
    Assert.AreEqual(54, day16b "04005AC33890")
    Assert.AreEqual(7, day16b "880086C3E88112")
    Assert.AreEqual(9, day16b "CE00C43D881120")
    Assert.AreEqual(1, day16b "D8005AC2A8F0")
    Assert.AreEqual(0, day16b "F600BC2D8F")
    Assert.AreEqual(0, day16b "9C005AC2F8F0")
    Assert.AreEqual(1, day16b "9C0141080250320F1802104A08")